<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculator</title>
  <style>
    :root{
      --bg: #0f172a;         /* slate-900 */
      --panel: #111827cc;    /* glass */
      --panel-light: #111827ee;
      --text: #e5e7eb;       /* gray-200 */
      --muted: #9ca3af;      /* gray-400 */
      --accent: #60a5fa;     /* blue-400 */
      --accent-2: #a78bfa;   /* violet-400 */
      --danger: #ef4444;
      --success: #22c55e;
      --shadow: 0 20px 50px rgba(0,0,0,.35);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 10%, #1f2937, transparent),
                  radial-gradient(900px 700px at 90% 80%, #0ea5e9, transparent),
                  linear-gradient(180deg, #0b1020, #0b1020);
      color:var(--text);
      display:grid; place-items:center;
      padding:24px;
    }

    .calc{
      width:min(92vw, 420px);
      background: linear-gradient(180deg, var(--panel), var(--panel-light));
      backdrop-filter: blur(12px) saturate(120%);
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .header{
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 18px; gap:12px;
      background: linear-gradient(90deg, rgba(96,165,250,.2), rgba(167,139,250,.2));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .brand{font-weight:700; letter-spacing:.5px}
    .theme-toggle{border:0; background:#00000033; color:var(--text); padding:8px 12px; border-radius:12px; cursor:pointer}

    .display{
      padding:18px; text-align:right; word-wrap:break-word; min-height:108px;
      display:flex; flex-direction:column; justify-content:flex-end; gap:10px;
    }
    .expr{font-size:1.6rem; color:#ffffff; line-height:1.2; letter-spacing:.5px}
    .preview{font-size:0.95rem; color:var(--muted)}

    .keys{ display:grid; gap:10px; padding:16px; grid-template-columns: repeat(4, 1fr); }

    button.key{
      appearance:none; border:0; cursor:pointer; border-radius:16px; padding:16px;
      background:#0b1225; color:var(--text); font-size:1.15rem; font-weight:600;
      box-shadow: inset 0 -2px 0 rgba(255,255,255,.03), 0 6px 16px rgba(0,0,0,.25);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
    }
    button.key:hover{ box-shadow: 0 10px 22px rgba(0,0,0,.35); }
    button.key:active{ transform: translateY(1px) scale(.99); }
    button.key:focus{ outline:2px solid var(--accent); outline-offset:2px; }

    .op{ background: linear-gradient(180deg, #1b2444, #141b33); }
    .op[data-op="Ã·"], .op[data-op="Ã—"], .op[data-op="âˆ’"], .op[data-op="+"]{ color:#bfdbfe; }
    .util{ background: #361a1a; color:#fecaca; }
    .eq{ background: linear-gradient(90deg, var(--accent), var(--accent-2)); color:black; font-weight:800; }

    .span-2{ grid-column: span 2; }

    .footer{padding:8px 16px 16px; text-align:center; color:var(--muted); font-size:.85rem}

    /* Light theme */
    .light body, body.light{ color:#0f172a; }
    body.light .calc{ background:#ffffffee; }
    body.light .display{ color:#0f172a }
    body.light .expr{ color:#0f172a }
    body.light .op{ background:#eef2ff }
    body.light .util{ background:#fee2e2; color:#991b1b }
    body.light .key{ background:#f1f5f9; color:#0f172a }
  </style>
</head>
<body>
  <div class="calc" role="application" aria-label="Basic Calculator">
    <div class="header">
      <div class="brand">ðŸ§® Calculator</div>
      <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="Toggle theme">â˜¾</button>
    </div>

    <div class="display" aria-live="polite">
      <div id="expr" class="expr" aria-label="expression">0</div>
      <div id="preview" class="preview" aria-label="live result">Â </div>
    </div>

    <div class="keys" id="keys" role="group" aria-label="calculator keys">
      <button class="key util" data-action="clear" aria-label="Clear">C</button>
      <button class="key util" data-action="delete" aria-label="Delete last">âŒ«</button>
      <button class="key op" data-op="%" aria-label="Percent">%</button>
      <button class="key op" data-op="Ã·" aria-label="Divide">Ã·</button>

      <button class="key" data-num="7">7</button>
      <button class="key" data-num="8">8</button>
      <button class="key" data-num="9">9</button>
      <button class="key op" data-op="Ã—" aria-label="Multiply">Ã—</button>

      <button class="key" data-num="4">4</button>
      <button class="key" data-num="5">5</button>
      <button class="key" data-num="6">6</button>
      <button class="key op" data-op="âˆ’" aria-label="Subtract">âˆ’</button>

      <button class="key" data-num="1">1</button>
      <button class="key" data-num="2">2</button>
      <button class="key" data-num="3">3</button>
      <button class="key op" data-op="+" aria-label="Add">+</button>

      <button class="key span-2" data-num="0">0</button>
      <button class="key" data-num=".">.</button>
      <button class="key eq" data-action="equals" aria-label="Equals">=</button>
    </div>

    <div class="footer">Keyboard: 0-9 â€¢ + - * / . â€¢ Enter (=) â€¢ Backspace (âŒ«) â€¢ Esc (C)</div>
  </div>

<script>
  const exprEl = document.getElementById('expr');
  const previewEl = document.getElementById('preview');
  const keys = document.getElementById('keys');
  const themeToggle = document.getElementById('themeToggle');

  let expr = '0';

  const sanitize = (s) => s
    .replace(/Ã—/g,'*')
    .replace(/Ã·/g,'/')
    .replace(/âˆ’/g,'-')
    .replace(/%/g,'/100');

  function updatePreview(){
    const safe = sanitize(expr);
    // Allow digits, operators, parentheses, decimals, spaces only
    if(!/^[-+*/(). 0-9]+$/.test(safe)) { previewEl.textContent = ''; return; }
    try {
      const result = Function(`"use strict"; return (${safe})`)();
      if (Number.isFinite(result)) {
        previewEl.textContent = '= ' + format(result);
      } else { previewEl.textContent = ''; }
    } catch { previewEl.textContent = ''; }
  }

  function format(n){
    return Number(n.toFixed(12)).toString();
  }

  function setExpr(newExpr){
    expr = newExpr;
    exprEl.textContent = expr || '0';
    updatePreview();
  }

  function append(token){
    if(expr === '0' && /[0-9.]/.test(token)){
      setExpr(token === '.' ? '0.' : token);
      return;
    }
    setExpr(expr + token);
  }

  function handleEquals(){
    const safe = sanitize(expr);
    try {
      const val = Function(`"use strict"; return (${safe})`)();
      if (Number.isFinite(val)) {
        setExpr(format(val));
        previewEl.textContent = '';
      }
    } catch { /* ignore */ }
  }

  function clearAll(){ setExpr('0'); }
  function deleteLast(){ setExpr(expr.length > 1 ? expr.slice(0, -1) : '0'); }

  // Clicks
  keys.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const num = btn.dataset.num;
    const op  = btn.dataset.op;
    const action = btn.dataset.action;

    if(num !== undefined) return append(num);
    if(op  !== undefined) return append(op);
    if(action === 'clear') return clearAll();
    if(action === 'delete') return deleteLast();
    if(action === 'equals') return handleEquals();
  });

  // Keyboard support
  window.addEventListener('keydown', (e)=>{
    const k = e.key;
    if(/^[0-9.]$/.test(k)) { append(k); return; }
    if(['+','-','*','/','(',')'].includes(k)) { append(k); return; }
    if(k === 'Enter' || k === '=') { e.preventDefault(); handleEquals(); return; }
    if(k === 'Backspace') { deleteLast(); return; }
    if(k === 'Escape') { clearAll(); return; }
  });

  // Theme toggle
  let light = false;
  themeToggle.addEventListener('click', ()=>{
    light = !light;
    document.body.classList.toggle('light', light);
    themeToggle.setAttribute('aria-pressed', String(light));
    themeToggle.textContent = light ? 'â˜€' : 'â˜¾';
  });

  // Initialize preview
  updatePreview();
</script>
</body>
</html>
